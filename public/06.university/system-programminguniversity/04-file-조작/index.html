<!DOCTYPE html>

<html lang="en-US"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    
    
    
    <title>04-FILE 조작 | My Test Site</title>
    

    
    
    <meta name="description" content=" 1.link() / unlink() / remove() / rename() umask() chmod() / fchmod() truncate() / ftruncate() utime() Directory mkdir() / opendir() / readdir() / …">

    
    
    <meta name="robots" content="index, follow">
    

    
    <link rel="canonical" href="http://localhost:1313/06.university/system-programminguniversity/04-file-%EC%A1%B0%EC%9E%91/">

    
    
    
    <meta property="og:title" content="04-FILE 조작">
    <meta property="og:description" content=" 1.link() / unlink() / remove() / rename() umask() chmod() / fchmod() truncate() / ftruncate() utime() Directory mkdir() / opendir() / readdir() / …">
    <meta property="og:url" content="http://localhost:1313/06.university/system-programminguniversity/04-file-%EC%A1%B0%EC%9E%91/">
    <meta property="og:site_name" content="My Test Site">
    
    <meta property="og:type" content="blog">
    

    
    
    

    
    
    
    <meta name="twitter:card" content="summary_large_image">
    
    <meta name="twitter:title" content="04-FILE 조작">
    <meta name="twitter:description" content=" 1.link() / unlink() / remove() / rename() umask() chmod() / fchmod() truncate() / ftruncate() utime() Directory mkdir() / opendir() / readdir() / …">
    

    
    
    

    
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>

</head><body>
    
     
    <header class="site-header">
        <div class="site-title">
            <a href="http://localhost:1313/">My Test Site</a>
        </div>
    </header>
    
    <nav class="site-nav">
        <ul>
            
        </ul>
    </nav>
    
    <main>
        
        
<article class="prose prose-sm lg:prose-base max-w-3xl mx-auto dk:prose-stone">
    <h1>04-FILE 조작 **page.html**</h1>
    <ol>
<li>1.link() / unlink() / remove() / rename()</li>
<li>umask()</li>
<li>chmod() / fchmod()</li>
<li>truncate() / ftruncate()</li>
<li>utime()</li>
<li>Directory</li>
<li>mkdir() / opendir() / readdir() / closedir() / rewinddir() / rmdir()</li>
<li>chdir() / getcwd()</li>
<li>Symbolic link</li>
<li>sync() / fsync()</li>
</ol>
<h2 id="파일-시스템">파일 시스템</h2>
<p>
        <img src="/08.media/20241005225333.png" alt=" (Image resource not found)" >

        <img src="/08.media/20241005230119.png" alt="Pasted image 20241005230119 (Image resource not found)" >

        <img src="/08.media/20241005230383.png" alt="Pasted image 20241005230383 (Image resource not found)" ></p>
<ul>
<li>Boot block
<ul>
<li>First block of the file system</li>
<li>Program to run system is located</li>
</ul>
</li>
<li>Super block
<ul>
<li>Boot 다음 영역</li>
<li>file system 관리 정보
<ul>
<li>size of file system</li>
<li>info for free block</li>
<li>info for i-node
<ul>
<li>file type</li>
<li>access permission bits</li>
<li>file size</li>
<li>Time stamp</li>
<li>Number of links</li>
<li>pointers to data blocks for the file</li>
<li>stat 구조체의 field들은 i-node에서 읽어온다</li>
</ul>
</li>
<li>block to modify that super block is modified</li>
<li>etc</li>
</ul>
</li>
<li>resides(상주하다) in kernel memory space in DRAM</li>
<li>Needed to be consistent with the super block in disk</li>
<li>Use &ldquo;sync&rdquo; system call (also a user cmd)</li>
</ul>
</li>
<li>i-node block list
<ul>
<li>Super block 다음의 영역</li>
<li>Consists of many i-nodes
<ul>
<li>1 i-node / 1 file</li>
<li>Identified by the i-node no.</li>
<li>File 관리에 필요한 정보 저장</li>
</ul>
</li>
</ul>
</li>
<li>Data block
<ul>
<li>Last area in the file system</li>
<li>Contains the data for general files and directory files.
<ul>
<li>general files</li>
<li>directory files
<ul>
<li>file name</li>
<li>i-node numbers for files</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="hard-link">hard link</h3>
<p>Link from directory block to i-node
Use i-node number to make the link (Linux command ‘ln’)
Hard link는 같은 file system 내부에서만 연결 가능</p>
<blockquote>
<p><strong>만약 디렉토리일 경우</strong>
inode block 의 inode 값은 특정 디렉토리의 data block 상의 주소를 가리킴
-&gt; data block 디렉토리 file 내부에 특정 파일의 inode 를 가리키는 주소값이 들어있음
-&gt; inode block 의 inode 가 특정 파일의  data block 상의 주소를 가리킴

        <img src="/08.media/20241005231545.png" alt="Pasted image 20241005231545 (Image resource not found)" > 
        <img src="/08.media/20241005231693.png" alt="Pasted image 20241005231693 (Image resource not found)" >

        <img src="/08.media/20241006010455.png" alt="Pasted image 20241006010455 (Image resource not found)" ></p>
<ul>
<li>i-node 2549 link count 최소 3</li>
<li>i-node 1267 link count 최소 2</li>
<li>루트 디렉토리의 경우 부모디렉토리(..)가 자기자신(.) 과 동일한 inode 를 가리킴</li>
</ul>
</blockquote>
<blockquote>
<p><strong>link count of i-node</strong>
number of directory entries that is pointing to an i-node
stat 구조체의 st_link
<strong>링크 카운트(link count)는 파일 시스템에서 특정 i-node가 얼마나 많은 디렉토리 엔트리와 연결되어 있는지를 나타내는 값 즉 나(i-node)를 가리키는 주소들 갯수</strong></p>
</blockquote>
<blockquote>
<p>방금 생성된 디렉토리 link count 가 기본적으로 2인 이유
상위 부모의 inode 가 가리키는 주소에 data block 에 디렉토리 정보(디렉토리 엔트리)에 나의 inode주소 값이 있다
나의 inode 가 가리키는 주소에 data block 에 디렉토리 정보에 (.) 이라는 나의 inode 를 가리키는 inode주소 값이 있다</p>
</blockquote>
<h3 id="symbolic-link">Symbolic link</h3>
<ul>
<li>Linux command ‘% ln –s /usr/lib lib’</li>
<li>ex) lrwxrwxrwx 1 root   7   Sep 25  07:14   lib -&gt; /usr/lib
<ul>
<li>File name: lib</li>
<li>Contents of file: /usr/lib</li>
<li>File size: 7 bytes</li>
</ul>
</li>
<li>The contents of file (data block) is the pathname of the target link</li>
</ul>
<h3 id="operations-on-file">Operations on file</h3>
<ul>
<li>Deleting a file
<ul>
<li>If a file is deleted in a directory block, link count of i-node decreases</li>
<li>If link count become zero, both i-node and data blocks of a file are deleted</li>
<li>일반 파일 삭제 과정
<ul>
<li>상위 디렉토리 정보(directory entry)에 나의 inode 주소값이 적혀있는 것을 지운다</li>
<li>자연스레 나를 가리키는 디렉토리 정보가 사라졌으므로 link count 값이 1 줄어든다</li>
<li>만약 link count 값이 0 이면 나의 inode 주소를 가리키는 주소를 가진 개체들이 없으므로 data block 의 값을 삭제해도 된다</li>
</ul>
</li>
</ul>
</li>
<li>Moving a file
<ul>
<li>Linux command: mv</li>
<li>Directory entry is changed without changing the i-node and data block of file</li>
</ul>
</li>
</ul>
<h3 id="파일-권한">파일 권한</h3>
<p>
        <img src="/08.media/20241006063697.png" alt="Pasted image 20241006063697 (Image resource not found)" >
umask : 가린다의 의미 mask 에 파일을 생성할 때 umask 값을 사용하여 적절히 생성한다</p>
<p>특수 권한

        <img src="/08.media/20241006193734.png" alt="Pasted image 20241006193734 (Image resource not found)" >
<a href="http://localhost:1313/temp/%EB%A6%AC%EB%88%85%EC%8A%A4-%ED%8C%8C%EC%9D%BC-%EA%B6%8C%ED%95%9C/" class="internal-link">리눅스 파일 권한</a>
<strong>Set UID</strong></p>
<ul>
<li>파일에 Set-UID 비트가 설정되면 다른 사용자가 파일을 실행했을때 해당 사용자의 권한이 아닌 파일의 소유자 권한으로 실행.</li>
<li>Set-UID 비트를 설정하기 위해 소유자 허가권에 s를 추가하거나 앞에 4를 붙여줌.
(ex 4750 =&gt; rwsr-x&mdash;)</li>
</ul>
<p><strong>Set GID</strong></p>
<ul>
<li>파일에 Set-GID 비트가 설정되면 다른 사용자가 파일을 실행했을때 해당 사용자의 권한이 아닌 그룹의 권한으로 실행</li>
<li>Set-GID 비트를 설정하기 위해 소유자 허가권에 s를 추가하거나 앞에 2를 붙여줌.
(ex 4750 =&gt; rwsr-x&mdash;)</li>
</ul>
<p><strong>Sticky-Bit</strong> 디렉토리만 설정 가능</p>
<ul>
<li>sticky-bit가 설정된 디렉토리에 파일을 생성하면 해당 파일은 생성한 사람의 소유가 되며, 오직 소유자와 root에게만 해당 파일에 대한 삭제 및 변경의 권한이 있다.</li>
<li>스티키비트 추가하기위해 문자방식인경우 t를 사용하고 숫자방식인경우 1 사용.</li>
</ul>
<h2 id="link">link</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span>  <span style="color:#a6e22e">link</span> (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>cur_path, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>new_path);
</span></span></code></pre></div><ul>
<li>This call makes a new link/directory entry (new_path) to an existing file (cur_path)
<ul>
<li>같은 i-node를 가리키는 directory entry가 하나 더 만들어짐</li>
<li>해당 i-node의 link count가 하나 증가</li>
</ul>
</li>
<li>Return values
<ul>
<li>Success: 0, link count increases</li>
<li>Error: -1</li>
</ul>
</li>
<li>Parameter
<ul>
<li>cur_path: current hard link (or pathname)</li>
<li>new_path: new hard link (or pathname)</li>
</ul>
</li>
</ul>
<blockquote>
<p>보통 link count가 0이 되면 해당 파일은 삭제되지만, 다른 프로세스가 사용중인 파일이 삭제되는 것을 방지하기 위해 link count가 0에 도달했더라도 그 파일을 open 한 프로세스의 수가 0 이상이면 삭제하지 않는다
파일이 close 될 때 kernel은 그 파일을 open 한 프로세스 수가 0 인지 확인하고, 0 일 경우 link count가 0 인지 확인하고 삭제한다</p>
</blockquote>
<p>unlink</p>
<h2 id="remove">remove</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">remove</span> (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>pathname);
</span></span></code></pre></div><p>if mathname is nomal file =&gt; remove = unlink
if mathnaem is dir file =&gt; remove = rmdir</p>
<h2 id="rename">rename</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">rename</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>oldpath, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>newpath);
</span></span></code></pre></div><p><code>rename()</code> 함수는 파일의 이름을 변경하며, 필요시 디렉토리 간에 이동할 수 있습니다. 이 함수는 다음과 같은 특성을 가지고 있습니다:</p>
<ul>
<li><strong>하드 링크와의 영향</strong>: 다른 하드 링크(예: <code>link(2)</code>를 사용하여 생성된 링크)에 대해서는 영향을 미치지 않습니다.</li>
<li><strong>열린 파일 디스크립터</strong>: <code>oldpath</code>에 대한 열린 파일 디스크립터는 영향을 받지 않습니다.</li>
</ul>
<p><code>rename()</code> 작업이 성공하는지 여부는 여러 가지 제약 조건에 따라 결정됩니다. 아래는 관련된 오류 상황입니다:</p>
<ul>
<li><strong>newpath가 이미 존재하는 경우</strong>: <code>rename()</code>은 원자적으로 대체되므로, 이 시점에서 다른 프로세스가 <code>newpath</code>를 접근하려고 할 때 파일이 없다고 발견되는 상황은 없습니다. 그러나 <code>oldpath</code>와 <code>newpath</code>가 모두 파일을 참조하는 상태가 발생할 수 있는 시간 여유가 있습니다.</li>
<li><strong>oldpath와 newpath가 동일한 하드 링크인 경우</strong>: 두 경로가 동일한 파일을 참조하고 있다면, <code>rename()</code>은 아무 작업도 하지 않고 성공 상태를 반환합니다.</li>
<li><strong>newpath가 존재하지만 작업이 실패하는 경우</strong>: 어떤 이유로든 작업이 실패하면, <code>rename()</code>은 <code>newpath</code>의 인스턴스를 그대로 유지합니다.</li>
<li><strong>oldpath가 디렉토리를 참조하는 경우</strong>: 이 경우, <code>newpath</code>는 존재하지 않거나 비어 있는 디렉토리를 지정해야 합니다.</li>
<li><strong>oldpath가 심볼릭 링크를 참조하는 경우</strong>: 링크가 이름이 변경됩니다. 만약 <code>newpath</code>가 심볼릭 링크를 참조한다면, 해당 링크는 덮어씌워집니다.</li>
</ul>
<h2 id="umask">umask</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">mode_t</span> <span style="color:#a6e22e">umask</span>(<span style="color:#66d9ef">mode_t</span> newmask);
</span></span></code></pre></div><ul>
<li>newmask: bitwise OR
<ul>
<li>S_IRUSR, S_IWUSR, S_IXUSR</li>
<li>S_IRGRP, S_IWGRP, S_IXGRP</li>
<li>S_IROTH, S_IWOTH, S_IXOTH</li>
</ul>
</li>
</ul>

</article>


        
        <footer class="site-footer">
            
            <address>
                
            </address>
            <p>&copy; 2025 My Test Site. All rights reserved.</p>
        </footer>
    </main>

    
    <aside class="sidebar">
        <h3>최근 글</h3>
        <ul>
            
            <li><a href="http://localhost:1313/signal-%EC%B0%A8%EC%9D%B4-unixmacos-vs-linux/">signal 차이 unix(macos) vs linux</a></li>
            
            <li><a href="http://localhost:1313/02.inbox/doxyzen-%ED%82%A4%EC%9B%8C%EB%93%9C/">Doxyzen 키워드</a></li>
            
            <li><a href="http://localhost:1313/02.inbox/%EB%B0%B1%EC%97%94%EB%93%9C-%EA%B5%AC%EC%A1%B0-%EB%B3%80%ED%99%94-%EC%97%AD%EC%82%AC/">백엔드 구조 변화 역사</a></li>
            
            <li><a href="http://localhost:1313/%EC%BD%94%EC%96%B4-%EB%8D%A4%ED%94%84core-dump/">코어 덤프(Core Dump)</a></li>
            
            <li><a href="http://localhost:1313/copilot/copilot-custom-prompts/translate-to-chinese/">Translate to Chinese</a></li>
            
        </ul>

        <h3>태그</h3>
        
        
    </aside>
</body>
</html>