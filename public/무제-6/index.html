<!DOCTYPE html>

<html lang="ko-KR"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    
    
    
    <title>무제 6 | My Test Site</title>
    

    
    
    <meta name="description" content="네, 직접 매우 단순한 WSGI 애플리케이션과 이를 실행할 수 있는 매우 단순한 WSGI 서버를 만들어 보겠습니다. 이를 통해 WSGI 인터페이스가 어떻게 동작하는지 직관적으로 이해할 수 있을 겁니다.
WSGI의 핵심 원리: Callable(호출 가능한 객체) WSGI …">

    
    
    <meta name="robots" content="index, follow">
    

    
    <link rel="canonical" href="http://localhost:1313/%EB%AC%B4%EC%A0%9C-6/">

    
    
    
    <meta property="og:title" content="무제 6">
    <meta property="og:description" content="네, 직접 매우 단순한 WSGI 애플리케이션과 이를 실행할 수 있는 매우 단순한 WSGI 서버를 만들어 보겠습니다. 이를 통해 WSGI 인터페이스가 어떻게 동작하는지 직관적으로 이해할 수 있을 겁니다.
WSGI의 핵심 원리: Callable(호출 가능한 객체) WSGI …">
    <meta property="og:url" content="http://localhost:1313/%EB%AC%B4%EC%A0%9C-6/">
    <meta property="og:site_name" content="My Test Site">
    
    <meta property="og:type" content="blog">
    

    
    
    

    
    
    
    <meta name="twitter:card" content="summary_large_image">
    
    <meta name="twitter:title" content="무제 6">
    <meta name="twitter:description" content="네, 직접 매우 단순한 WSGI 애플리케이션과 이를 실행할 수 있는 매우 단순한 WSGI 서버를 만들어 보겠습니다. 이를 통해 WSGI 인터페이스가 어떻게 동작하는지 직관적으로 이해할 수 있을 겁니다.
WSGI의 핵심 원리: Callable(호출 가능한 객체) WSGI …">
    

    
    
    

    
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>

</head><body>
    
     
    <header class="site-header">
        <div class="site-title">
            <a href="http://localhost:1313/">My Test Site</a>
        </div>
    </header>
    
    <nav class="site-nav">
        <ul>
            
        </ul>
    </nav>
    
    <main>
        
        
<article class="prose prose-sm lg:prose-base max-w-3xl mx-auto dk:prose-stone">
    <h1>무제 6 **page.html**</h1>
    <p>네, 직접 매우 단순한 WSGI 애플리케이션과 이를 실행할 수 있는 매우 단순한 WSGI 서버를 만들어 보겠습니다. 이를 통해 WSGI 인터페이스가 어떻게 동작하는지 직관적으로 이해할 수 있을 겁니다.</p>
<hr>
<h2 id="wsgi의-핵심-원리-callable호출-가능한-객체">WSGI의 핵심 원리: Callable(호출 가능한 객체)</h2>
<p>WSGI의 가장 중요한 부분은 &ldquo;애플리케이션&quot;이 <code>application(environ, start_response)</code> 이라는 시그니처를 가진 **호출 가능한 객체(callable)**여야 한다는 것입니다.</p>
<ul>
<li><code>environ</code>: 웹 서버로부터 받은 요청 정보(HTTP 헤더, 경로, 쿼리 파라미터 등)를 담은 딕셔너리입니다.</li>
<li><code>start_response</code>: 애플리케이션이 웹 서버에게 HTTP 응답 상태 코드(예: &ldquo;200 OK&rdquo;)와 응답 헤더를 보내기 위해 호출해야 하는 함수입니다. 웹 서버가 이 함수를 제공합니다.</li>
</ul>
<p>애플리케이션은 이 두 인자를 받아 처리하고, 응답 본문(body)을 포함하는 <strong>이터러블(iterable)</strong> 객체를 반환해야 합니다.</p>
<hr>
<h2 id="1-매우-단순한-wsgi-애플리케이션-my_simple_apppy">1. 매우 단순한 WSGI 애플리케이션 (<code>my_simple_app.py</code>)</h2>
<p>이것은 우리가 만들 웹 &ldquo;애플리케이션&quot;입니다. 웹 프레임워크 없이 순수 WSGI 규약에 맞춰 작성됩니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># my_simple_app.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">my_simple_app</span>(environ, start_response):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    이것은 WSGI 규약을 따르는 매우 단순한 웹 애플리케이션입니다.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        environ (dict): 웹 서버로부터 받은 요청 정보(환경 변수).
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        예: &#39;REQUEST_METHOD&#39;, &#39;PATH_INFO&#39;, &#39;QUERY_STRING&#39; 등
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                        &#39;wsgi.input&#39;, &#39;wsgi.errors&#39; 등 WSGI 관련 정보도 포함.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        start_response (callable): 서버가 제공하는 함수로, 애플리케이션이
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                                  HTTP 응답 상태 코드와 헤더를 서버에 전달할 때 사용합니다.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                                  시그니처: start_response(status, headers, exc_info=None)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        iterable: 응답 본문(body)을 포함하는 바이트 문자열의 이터러블.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    status <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;200 OK&#39;</span>  <span style="color:#75715e"># HTTP 상태 코드</span>
</span></span><span style="display:flex;"><span>    headers <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>        (<span style="color:#e6db74">&#39;Content-type&#39;</span>, <span style="color:#e6db74">&#39;text/plain; charset=utf-8&#39;</span>),
</span></span><span style="display:flex;"><span>        (<span style="color:#e6db74">&#39;X-Powered-By&#39;</span>, <span style="color:#e6db74">&#39;MySimpleWSGIApp&#39;</span>) <span style="color:#75715e"># 커스텀 헤더도 가능</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># start_response 함수를 호출하여 상태 코드와 헤더를 서버에게 전달합니다.</span>
</span></span><span style="display:flex;"><span>    start_response(status, headers)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 요청 경로를 확인하여 다른 응답을 줄 수 있습니다.</span>
</span></span><span style="display:flex;"><span>    path <span style="color:#f92672">=</span> environ<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;PATH_INFO&#39;</span>, <span style="color:#e6db74">&#39;/&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> path <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;/&#39;</span>:
</span></span><span style="display:flex;"><span>        response_body <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;Hello from My Simple WSGI App! (Homepage)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> path <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;/hello&#39;</span>:
</span></span><span style="display:flex;"><span>        response_body <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;Hello, specific page!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> path <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;/info&#39;</span>:
</span></span><span style="display:flex;"><span>        response_body <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;Environment info:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># environ 딕셔너리의 내용을 응답 본문에 추가</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> key, value <span style="color:#f92672">in</span> sorted(environ<span style="color:#f92672">.</span>items()):
</span></span><span style="display:flex;"><span>            response_body <span style="color:#f92672">+=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>key<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>value<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>encode(<span style="color:#e6db74">&#39;utf-8&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        status <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;404 Not Found&#39;</span>
</span></span><span style="display:flex;"><span>        headers <span style="color:#f92672">=</span> [(<span style="color:#e6db74">&#39;Content-type&#39;</span>, <span style="color:#e6db74">&#39;text/plain; charset=utf-8&#39;</span>)]
</span></span><span style="display:flex;"><span>        start_response(status, headers) <span style="color:#75715e"># 404 상태로 다시 호출</span>
</span></span><span style="display:flex;"><span>        response_body <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;404 Not Found: This page does not exist.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 응답 본문은 바이트 문자열의 이터러블이어야 합니다.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 단순화를 위해 여기서는 하나의 바이트 문자열을 리스트에 담아 반환합니다.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [response_body]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 이 파일이 직접 실행될 경우 (예: 개발 서버용)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 이 부분은 실제 WSGI 서버(Gunicorn, uWSGI)가 하는 일을 매우 간소화한 것입니다.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 실제 서버가 애플리케이션을 로드하여 실행합니다.</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;This is a WSGI application module. It needs a WSGI server to run.&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Try running `python simple_wsgi_server.py` and access http://localhost:8000/&#34;</span>)
</span></span></code></pre></div><hr>
<h2 id="2-매우-단순한-wsgi-서버-simple_wsgi_serverpy">2. 매우 단순한 WSGI 서버 (<code>simple_wsgi_server.py</code>)</h2>
<p>이것은 클라이언트의 HTTP 요청을 받아 우리 <code>my_simple_app</code> WSGI 애플리케이션을 호출하고, 그 결과를 클라이언트에게 다시 HTTP 응답으로 보내는 역할을 하는 서버입니다. 실제 Gunicorn이나 uWSGI와 비교할 수 없을 정도로 단순하며, 한 번에 하나의 요청만 처리합니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># simple_wsgi_server.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> socket
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os <span style="color:#75715e"># PATH_INFO에 필요한 모듈</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 우리가 만든 WSGI 애플리케이션을 임포트합니다.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> my_simple_app <span style="color:#f92672">import</span> my_simple_app
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SimpleWSGIServer</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, host, port, application):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>host <span style="color:#f92672">=</span> host
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>port <span style="color:#f92672">=</span> port
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>application <span style="color:#f92672">=</span> application
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>socket <span style="color:#f92672">=</span> socket<span style="color:#f92672">.</span>socket(socket<span style="color:#f92672">.</span>AF_INET, socket<span style="color:#f92672">.</span>SOCK_STREAM)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 개발 시 재시작할 때 주소가 이미 사용 중인 문제를 방지</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>socket<span style="color:#f92672">.</span>setsockopt(socket<span style="color:#f92672">.</span>SOL_SOCKET, socket<span style="color:#f92672">.</span>SO_REUSEADDR, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">serve_forever</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>socket<span style="color:#f92672">.</span>bind((self<span style="color:#f92672">.</span>host, self<span style="color:#f92672">.</span>port))
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>socket<span style="color:#f92672">.</span>listen(<span style="color:#ae81ff">1</span>) <span style="color:#75715e"># 한 번에 하나의 연결만 대기</span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Serving WSGI app on http://</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>host<span style="color:#e6db74">}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>port<span style="color:#e6db74">}</span><span style="color:#e6db74">/...&#34;</span>)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Try accessing /hello, /info, or /nonexistent_page&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>            client_connection, client_address <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>socket<span style="color:#f92672">.</span>accept()
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Accepted connection from </span><span style="color:#e6db74">{</span>client_address<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>handle_request(client_connection)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">handle_request</span>(self, client_connection):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 1. 클라이언트 요청 데이터 수신 및 파싱</span>
</span></span><span style="display:flex;"><span>        request_data <span style="color:#f92672">=</span> client_connection<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">1024</span>)<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;utf-8&#39;</span>)
</span></span><span style="display:flex;"><span>        request_lines <span style="color:#f92672">=</span> request_data<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> request_lines:
</span></span><span style="display:flex;"><span>            client_connection<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        request_line <span style="color:#f92672">=</span> request_lines[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            method, path, version <span style="color:#f92672">=</span> request_line<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39; &#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">ValueError</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 유효하지 않은 요청 라인 처리</span>
</span></span><span style="display:flex;"><span>            client_connection<span style="color:#f92672">.</span>sendall(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;HTTP/1.1 400 Bad Request</span><span style="color:#ae81ff">\r\n\r\n</span><span style="color:#e6db74">Bad Request&#34;</span>)
</span></span><span style="display:flex;"><span>            client_connection<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 2. `environ` 딕셔너리 생성 (매우 간소화된 버전)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 실제 WSGI 서버는 이 딕셔너리를 훨씬 더 풍부하게 채웁니다.</span>
</span></span><span style="display:flex;"><span>        environ <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;REQUEST_METHOD&#39;</span>: method,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;PATH_INFO&#39;</span>: path<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;?&#39;</span>)[<span style="color:#ae81ff">0</span>], <span style="color:#75715e"># 쿼리 스트링 분리</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;QUERY_STRING&#39;</span>: path<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;?&#39;</span>)[<span style="color:#ae81ff">1</span>] <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;?&#39;</span> <span style="color:#f92672">in</span> path <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#39;&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;SERVER_NAME&#39;</span>: self<span style="color:#f92672">.</span>host,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;SERVER_PORT&#39;</span>: str(self<span style="color:#f92672">.</span>port),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;SERVER_PROTOCOL&#39;</span>: version,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;wsgi.version&#39;</span>: (<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;wsgi.url_scheme&#39;</span>: <span style="color:#e6db74">&#39;http&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;wsgi.input&#39;</span>: client_connection<span style="color:#f92672">.</span>makefile(<span style="color:#e6db74">&#39;rb&#39;</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>), <span style="color:#75715e"># 요청 본문 스트림 (여기에선 사용 안함)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;wsgi.errors&#39;</span>: sys<span style="color:#f92672">.</span>stderr, <span style="color:#75715e"># 에러 로그 스트림</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;wsgi.multithread&#39;</span>: <span style="color:#66d9ef">False</span>, <span style="color:#75715e"># 이 서버는 단일 쓰레드</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;wsgi.multiprocess&#39;</span>: <span style="color:#66d9ef">False</span>, <span style="color:#75715e"># 이 서버는 단일 프로세스</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;wsgi.run_once&#39;</span>: <span style="color:#66d9ef">False</span>, <span style="color:#75715e"># 계속 실행됨</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 3. `start_response` 콜러블 정의</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 이 함수는 애플리케이션이 호출하여 응답 상태 및 헤더를 서버에게 알려줍니다.</span>
</span></span><span style="display:flex;"><span>        headers_set <span style="color:#f92672">=</span> [] <span style="color:#75715e"># 애플리케이션이 설정할 상태 및 헤더를 저장할 리스트</span>
</span></span><span style="display:flex;"><span>        response_started <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">start_response</span>(status, headers, exc_info<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">nonlocal</span> response_started
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> response_started:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">RuntimeError</span>(<span style="color:#e6db74">&#34;start_response() already called!&#34;</span>)
</span></span><span style="display:flex;"><span>            response_started <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            headers_set<span style="color:#f92672">.</span>append(status)
</span></span><span style="display:flex;"><span>            headers_set<span style="color:#f92672">.</span>extend(headers)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># exc_info는 에러 처리 시 사용되지만, 여기서는 생략합니다.</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># print(f&#34;[Server] App called start_response: Status={status}, Headers={headers}&#34;)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span> <span style="color:#75715e"># WSGI 스펙에 따라 None 반환</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 4. WSGI 애플리케이션 호출</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            app_body_iterable <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>application(environ, start_response)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 5. HTTP 응답 구성 및 전송</span>
</span></span><span style="display:flex;"><span>            response_status <span style="color:#f92672">=</span> headers_set[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>            response_headers <span style="color:#f92672">=</span> headers_set[<span style="color:#ae81ff">1</span>:]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            response_line <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;HTTP/1.1 </span><span style="color:#e6db74">{</span>response_status<span style="color:#e6db74">}</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            response_headers_str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> header_name, header_value <span style="color:#f92672">in</span> response_headers:
</span></span><span style="display:flex;"><span>                response_headers_str <span style="color:#f92672">+=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>header_name<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>header_value<span style="color:#e6db74">}</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 최종 헤더</span>
</span></span><span style="display:flex;"><span>            full_response_headers <span style="color:#f92672">=</span> (response_line <span style="color:#f92672">+</span> response_headers_str <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#34;</span>)<span style="color:#f92672">.</span>encode(<span style="color:#e6db74">&#39;utf-8&#39;</span>)
</span></span><span style="display:flex;"><span>            client_connection<span style="color:#f92672">.</span>sendall(full_response_headers)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 애플리케이션이 반환한 이터러블로부터 본문을 읽어 전송</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> data <span style="color:#f92672">in</span> app_body_iterable:
</span></span><span style="display:flex;"><span>                client_connection<span style="color:#f92672">.</span>sendall(data) <span style="color:#75715e"># data는 이미 바이트 문자열이어야 합니다.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 애플리케이션 내부에서 발생한 예상치 못한 오류 처리</span>
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Error handling request: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>, file<span style="color:#f92672">=</span>sys<span style="color:#f92672">.</span>stderr)
</span></span><span style="display:flex;"><span>            error_response <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;HTTP/1.1 500 Internal Server Error</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">Content-Type: text/plain</span><span style="color:#ae81ff">\r\n\r\n</span><span style="color:#e6db74">Internal Server Error&#34;</span>
</span></span><span style="display:flex;"><span>            client_connection<span style="color:#f92672">.</span>sendall(error_response)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">finally</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 요청 처리 완료 후 클라이언트 연결 닫기</span>
</span></span><span style="display:flex;"><span>            client_connection<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Connection from </span><span style="color:#e6db74">{</span>client_address<span style="color:#e6db74">}</span><span style="color:#e6db74"> closed.&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 서버 실행</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    HOST <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;127.0.0.1&#39;</span> <span style="color:#75715e"># localhost</span>
</span></span><span style="display:flex;"><span>    PORT <span style="color:#f92672">=</span> <span style="color:#ae81ff">8000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    server <span style="color:#f92672">=</span> SimpleWSGIServer(HOST, PORT, my_simple_app)
</span></span><span style="display:flex;"><span>    server<span style="color:#f92672">.</span>serve_forever()
</span></span></code></pre></div><hr>
<h2 id="실행-방법">실행 방법</h2>
<ol>
<li>
<p>위 코드들을 각각 <code>my_simple_app.py</code>와 <code>simple_wsgi_server.py</code> 파일로 저장합니다.</p>
</li>
<li>
<p>터미널을 열고 <code>simple_wsgi_server.py</code> 파일이 있는 디렉토리로 이동합니다.</p>
</li>
<li>
<p>다음 명령어를 실행합니다:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python simple_wsgi_server.py
</span></span></code></pre></div></li>
<li>
<p>콘솔에 &ldquo;Serving WSGI app on http://127.0.0.1:8000/&hellip;&rdquo; 메시지가 나타나면, 웹 브라우저를 열고 다음 주소들을 방문해 보세요:</p>
<ul>
<li><code>http://127.0.0.1:8000/</code></li>
<li><code>http://127.0.0.1:8000/hello</code></li>
<li><code>http://127.0.0.1:8000/info</code> (environ 딕셔너리 내용을 볼 수 있습니다)</li>
<li><code>http://127.0.0.1:8000/nonexistent_page</code> (404 에러를 확인)</li>
</ul>
</li>
</ol>
<hr>
<h2 id="코드-설명-및-wsgi-이해">코드 설명 및 WSGI 이해</h2>
<p>이 예제를 통해 WSGI의 핵심을 이해할 수 있습니다:</p>
<ol>
<li>
<p><strong>애플리케이션(App)과 서버(Server)의 분리:</strong></p>
<ul>
<li><code>my_simple_app.py</code>는 오직 WSGI 규약에 맞춰 <code>application</code>이라는 함수를 구현합니다. 이 함수는 HTTP 요청/응답에 대한 지식은 거의 없고, 오직 <code>environ</code> 딕셔너리와 <code>start_response</code> 함수를 다루는 방법만 압니다.</li>
<li><code>simple_wsgi_server.py</code>는 HTTP 프로토콜(소켓 통신, 요청 파싱, 응답 전송)을 처리하고, <code>my_simple_app</code>을 호출하기 위한 <code>environ</code>과 <code>start_response</code>를 준비합니다.</li>
<li>이러한 분리 덕분에, 개발자는 <code>my_simple_app</code>과 같은 WSGI 애플리케이션을 한 번 작성하면, 어떤 WSGI 호환 서버(Gunicorn, uWSGI 등)에서도 실행할 수 있습니다. 반대로, 서버 개발자는 어떤 WSGI 호환 애플리케이션이라도 실행할 수 있습니다.</li>
</ul>
</li>
<li>
<p><strong><code>environ</code> 딕셔너리:</strong></p>
<ul>
<li>서버는 클라이언트의 HTTP 요청을 파싱하여 다양한 정보를 <code>environ</code> 딕셔너리에 담아 애플리케이션에 전달합니다. <code>PATH_INFO</code>, <code>REQUEST_METHOD</code>, <code>QUERY_STRING</code> 등이 대표적입니다.</li>
<li>또한 <code>wsgi.version</code>, <code>wsgi.input</code> (요청 본문을 읽기 위한 파일 객체), <code>wsgi.errors</code> (에러 로그를 위한 파일 객체)와 같은 WSGI 자체의 환경 변수도 포함됩니다.</li>
</ul>
</li>
<li>
<p><strong><code>start_response</code> 콜러블:</strong></p>
<ul>
<li>애플리케이션은 응답 본문을 반환하기 전에 반드시 이 <code>start_response</code> 함수를 호출해야 합니다. 이 호출을 통해 서버는 HTTP 상태 코드(예: &ldquo;200 OK&rdquo;)와 응답 헤더(예: <code>Content-Type</code>)를 알게 되고, 실제 응답의 첫 부분을 클라이언트에게 보낼 준비를 합니다.</li>
</ul>
</li>
<li>
<p><strong>반환 값: 이터러블 본문:</strong></p>
<ul>
<li>애플리케이션은 응답 본문을 바이트 문자열의 이터러블로 반환합니다. 이 예제에서는 <code>[b&quot;Hello...&quot;]</code>와 같이 하나의 리스트에 담았지만, 큰 파일 전송의 경우 제너레이터를 사용하여 메모리 효율적으로 데이터를 스트리밍할 수도 있습니다.</li>
</ul>
</li>
</ol>
<p>이 간단한 예제를 통해 WSGI가 웹 서버와 Python 웹 애플리케이션 사이에 어떻게 표준화된 인터페이스 역할을 하는지 이해할 수 있을 것입니다. 실제 Gunicorn 같은 WSGI 서버는 이 기본적인 원리 위에 멀티프로세싱/멀티스레딩, 로깅, 설정 관리 등 훨씬 더 복잡한 기능들을 추가하여 프로덕션 환경에 적합하도록 만듭니다.</p>

</article>


        
        <footer class="site-footer">
            
            <address>
                
            </address>
            <p>&copy; 2025 My Test Site. All rights reserved.</p>
        </footer>
    </main>

    
    <aside class="sidebar">
        <h3>최근 글</h3>
        <ul>
            
            <li><a href="http://localhost:1313/02.inbox/di-%EC%9D%98%EC%A1%B4%EC%84%B1-%EC%A3%BC%EC%9E%85-%EC%9D%98-%ED%83%80-%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC-%EC%A0%91%EA%B7%BC-%EC%9C%A0%ED%8A%9C%EB%B8%8C-%EB%8C%93%EA%B8%80/">di (의존성 주입) 의 타 프레임워크 접근 유튜브 댓글</a></li>
            
            <li><a href="http://localhost:1313/%EB%AC%B4%EC%A0%9C-12/">무제 12</a></li>
            
            <li><a href="http://localhost:1313/temp/tmux/">tmux</a></li>
            
            <li><a href="http://localhost:1313/02.inbox/doxyzen-%ED%82%A4%EC%9B%8C%EB%93%9C/">Doxyzen 키워드</a></li>
            
            <li><a href="http://localhost:1313/university-algorizm/">university algorizm</a></li>
            
        </ul>

        <h3>태그</h3>
        
        
    </aside>
</body>
</html>