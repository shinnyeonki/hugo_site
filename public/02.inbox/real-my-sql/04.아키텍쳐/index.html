<!DOCTYPE html>

<html lang="ko-KR"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    
    
    
    <title>04.아키텍쳐 | My Test Site</title>
    

    
    
    <meta name="description" content="mysql 엔진 : 커넥션핸들러, sql 파서, 전처리기, 옵티마이저 스토리지 엔진 : 데이터를 스토리지에 W 또는 R =&gt; 키캐시(MyISAM) 또는 버퍼풀기능
mysql 엔진 -&gt; 스토리지 엔진으로 요청시 헨들러 api 사용
SHOW GLOBAL …">

    
    
    <meta name="robots" content="index, follow">
    

    
    <link rel="canonical" href="http://localhost:1313/02.inbox/real-my-sql/04.%EC%95%84%ED%82%A4%ED%85%8D%EC%B3%90/">

    
    
    
    <meta property="og:title" content="04.아키텍쳐">
    <meta property="og:description" content="mysql 엔진 : 커넥션핸들러, sql 파서, 전처리기, 옵티마이저 스토리지 엔진 : 데이터를 스토리지에 W 또는 R =&gt; 키캐시(MyISAM) 또는 버퍼풀기능
mysql 엔진 -&gt; 스토리지 엔진으로 요청시 헨들러 api 사용
SHOW GLOBAL …">
    <meta property="og:url" content="http://localhost:1313/02.inbox/real-my-sql/04.%EC%95%84%ED%82%A4%ED%85%8D%EC%B3%90/">
    <meta property="og:site_name" content="My Test Site">
    
    <meta property="og:type" content="blog">
    

    
    
    

    
    
    
    <meta name="twitter:card" content="summary_large_image">
    
    <meta name="twitter:title" content="04.아키텍쳐">
    <meta name="twitter:description" content="mysql 엔진 : 커넥션핸들러, sql 파서, 전처리기, 옵티마이저 스토리지 엔진 : 데이터를 스토리지에 W 또는 R =&gt; 키캐시(MyISAM) 또는 버퍼풀기능
mysql 엔진 -&gt; 스토리지 엔진으로 요청시 헨들러 api 사용
SHOW GLOBAL …">
    

    
    
    

    
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>

</head><body>
    
     
    <header class="site-header">
        <div class="site-title">
            <a href="http://localhost:1313/">My Test Site</a>
        </div>
    </header>
    
    <nav class="site-nav">
        <ul>
            
        </ul>
    </nav>
    
    <main>
        
        
<article class="prose prose-sm lg:prose-base max-w-3xl mx-auto dk:prose-stone">
    <h1>04.아키텍쳐 **page.html**</h1>
    <p>mysql 엔진 : 커넥션핸들러, sql 파서, 전처리기, 옵티마이저
스토리지 엔진 : 데이터를 스토리지에 W 또는 R =&gt; 키캐시(MyISAM) 또는 버퍼풀기능</p>
<p>mysql 엔진 -&gt; 스토리지 엔진으로 요청시 헨들러 api 사용</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SHOW</span> <span style="color:#66d9ef">GLOBAL</span> STATUS <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;handler%&#39;</span>;
</span></span></code></pre></div><p>실행중인 스레드 목록</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> thread_id, name, <span style="color:#66d9ef">type</span>, processlist_user, processlist_host 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> performance_schema.threads 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> thread_id;
</span></span></code></pre></div><p>플러그인 시스템 컴포넌트 시스템 차이
        <img src="/08.media/20241214193749.png" alt=" (Image resource not found)" >
플러그인 : <code>show plugins;</code>
컴포넌트 : <code>select * from mysql.component;</code></p>
<h2 id="innodb">innodb</h2>
<p>
        <img src="/08.media/20241220052896.png" alt="Pasted image 20241220052896 (Image resource not found)" >

        <img src="/08.media/20241220052912.png" alt="Pasted image 20241220052912 (Image resource not found)" ></p>
<p>데드락 감지 스레드(innodb_deadlock_detect) 을 OFF 하고 deadlock 발생을 시간(특정 데이터의 xlock 요청에 의한 잠김시간)으로 감지해서 요청 실패로 처리가능 innodb_lock_wait_timeout</p>
<h3 id="innodb-buffer-pool">innodb buffer pool</h3>
<p>nodb_buffer_pool_size = innodb_buffer_pool_chunk_size * innodb_buffer_pool_instances
청크는 128MB 단위 pool size 기본값 128M 즉 인스턴스 1
<code>show variables like '%innodb_buffer%';</code></p>
<ol>
<li>LRU(LRU+MRU)</li>
<li>플러쉬(flush)</li>
<li>프리(free)
<code>SHOW engine innodb status</code></li>
<li>innodb_page_cleaners : 이 변수는 더티 페이지를 디스크에 동기화하는 클리너 스레드의 수를 설정합니다 이 변수의 값은 버퍼 풀 인스턴스 수보다 작아야 한다</li>
<li>innodb_max_dirty_pages_pct_lwm : 이 변수는 더티 페이지의 비율이 이 값 이하로 떨어질 때까지 클리너 스레드가 더티 페이지를 디스크에 기록. LWM(Low Water Mark)은 페이지가 낮은 임계값에 도달했을 때 동작을 시작하는 기준.</li>
<li>innodb_max_dirty_pages_pct : 이 변수는 버퍼 풀 내에서 더티 페이지가 차지할 수 있는 최대 비율을 설정. 이 비율을 초과하면 InnoDB는 더티 페이지를 디스크에 플러시하여 비율을 줄이려 한다. 기본값은 75%</li>
<li>innodb_io_capacity : 이 변수는 InnoDB가 I/O 작업을 수행할 수 있는 최대 용량을 설정한다. 디스크의 I/O 성능에 따라 이 값을 조정하여 성능을 최적화할 수 있다. 기본값은 200. &lt;= 실제 디스크 성능보다는 db 서버가 사용할 수 있는 속도</li>
<li>innodb_io_capacity_max : 이 변수는 InnoDB가 I/O 작업을 수행할 수 있는 최대 I/O 용량을 설정. innodb_io_capacity보다 큰 값을 설정할 수 있으며, 주로 고속 SSD와 같은 스토리지 장치를 사용할 때 유용.</li>
<li>innodb_adaptive_flushing : 이 변수는 InnoDB가 플러시 작업을 적응적으로 조절할 수 있도록 설정합니다. 이 기능을 활성화하면 시스템의 현재 부하에 따라 플러시 빈도를 조절하여 성능을 최적화할 수 있습니다.</li>
<li>innodb_adaptive_flushing_lwm : 이 변수는 적응형 플러싱이 활성화된 경우, 더티 페이지 비율이 이 값 이하로 떨어질 때까지 플러시 작업을 수행하도록 설정합니다. LWM이 낮을수록 더티 페이지를 더 자주 플러시하게 됩니다.</li>
<li>innodb_flush_neighbors : 이 변수는 InnoDB가 페이지를 디스크에 플러시할 때, 해당 페이지의 이웃 페이지도 함께 플러시할지 여부를 결정. 값이 1이면 이웃 페이지를 플러시하고, 0이면 플러시하지 않는다. SSD와 같은 스토리지에서는 0으로 설정(활성화 하지 않음 랜덤 읽기 성능이 뛰어나므로)하는 것이 성능에 유리할 수 있음</li>
</ol>
<p>
        <img src="/08.media/20241217022648.png" alt="Pasted image 20241217022648 (Image resource not found)" >

        <img src="/08.media/20241217063871.png" alt="Pasted image 20241217063871 (Image resource not found)" >
각 테이블의 인덱스별 데이터 페이지가 얼만큼 Innodb buffer pool 에 적제되어 있는가</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>	it.name <span style="color:#66d9ef">table_name</span>,
</span></span><span style="display:flex;"><span>	ii.name index_name,
</span></span><span style="display:flex;"><span>	ici.n_cached_pages n_cached_pages
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> information_schema. innodb_tables it
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> information_schema. innodb_indexes ii <span style="color:#66d9ef">ON</span> ii. table_id <span style="color:#f92672">=</span> it.table_id
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> information_schema.innodb_cached_indexes ici <span style="color:#66d9ef">ON</span> ici.index_id <span style="color:#f92672">=</span> ii.index_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> it.name<span style="color:#f92672">=</span>CONCAT(<span style="color:#e6db74">&#39;employees&#39;</span>, <span style="color:#e6db74">&#39;/&#39;</span>, <span style="color:#e6db74">&#39;employees&#39;</span>);
</span></span></code></pre></div><p>테이블 전체 페이지 중에서 어느정도의 비율이 Innodb 버퍼풀에 적재되어 있는가</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>	(<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">SUM</span>(ici.n_cached_pages) n_cached_pages
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">FROM</span> information_schema.innodb_tables it
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> information_schema.innodb_indexes ii <span style="color:#66d9ef">ON</span> ii. table_id <span style="color:#f92672">=</span> it. table_id
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> information_schema.innodb_cached_indexes ici <span style="color:#66d9ef">ON</span> ici.index_id <span style="color:#f92672">=</span> ii.index_id
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">WHERE</span> it.name<span style="color:#f92672">=</span>CONCAT(t.table_schema, <span style="color:#e6db74">&#39;/&#39;</span>, t.<span style="color:#66d9ef">table_name</span>)) <span style="color:#66d9ef">as</span> total_cached_pages, ((t.data_length <span style="color:#f92672">+</span> t.index_length <span style="color:#f92672">-</span> t.data_free)<span style="color:#f92672">/@@</span>innodb_page_size) <span style="color:#66d9ef">as</span> total_pages
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> information_schema.tables t
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> t.table_schema<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;employees&#39;</span> <span style="color:#66d9ef">AND</span> t.<span style="color:#66d9ef">table_name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;employees&#39;</span>;
</span></span></code></pre></div><p>리두로그에는 변경된 단일 데이터?
double write buffer 에는 변경된 전체 페이지</p>
<p>언두 레코드 건수</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">count</span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> information_schema.innodb_metrics 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> SUBSYSTEM<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;transaction&#39;</span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">AND</span> NAME<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;trx_rseg_history_len&#39;</span>;
</span></span></code></pre></div>
</article>


        
        <footer class="site-footer">
            
            <address>
                
            </address>
            <p>&copy; 2025 My Test Site. All rights reserved.</p>
        </footer>
    </main>

    
    <aside class="sidebar">
        <h3>최근 글</h3>
        <ul>
            
            <li><a href="http://localhost:1313/02.inbox/di-%EC%9D%98%EC%A1%B4%EC%84%B1-%EC%A3%BC%EC%9E%85-%EC%9D%98-%ED%83%80-%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC-%EC%A0%91%EA%B7%BC-%EC%9C%A0%ED%8A%9C%EB%B8%8C-%EB%8C%93%EA%B8%80/">di (의존성 주입) 의 타 프레임워크 접근 유튜브 댓글</a></li>
            
            <li><a href="http://localhost:1313/%EB%AC%B4%EC%A0%9C-12/">무제 12</a></li>
            
            <li><a href="http://localhost:1313/temp/tmux/">tmux</a></li>
            
            <li><a href="http://localhost:1313/02.inbox/doxyzen-%ED%82%A4%EC%9B%8C%EB%93%9C/">Doxyzen 키워드</a></li>
            
            <li><a href="http://localhost:1313/university-algorizm/">university algorizm</a></li>
            
        </ul>

        <h3>태그</h3>
        
        
    </aside>
</body>
</html>