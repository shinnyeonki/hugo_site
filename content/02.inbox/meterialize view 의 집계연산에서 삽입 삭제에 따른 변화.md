---
title: meterialize view 의 집계연산에서 삽입 삭제에 따른 변화
resource-path: 02.inbox/meterialize view 의 집계연산에서 삽입 삭제에 따른 변화.md
aliases:
tags:
  - dbms
date: 2024-12-04T15:56:00+09:00
lastmod: 2024-12-04T15:56:00+09:00
---
아래는 집계 연산에서 `count`, `sum`, `avg`, `min`, `max`의 삽입 및 삭제에 따른 변화를 중심으로 설명하겠습니다.

## 1. Count

### 삽입
- **동작**: 새로운 튜플이 삽입되면, 해당 튜플의 그룹이 이미 존재하는지 확인합니다.
  - **존재하는 경우**: 해당 그룹의 카운트를 1 증가시킵니다.
  - **존재하지 않는 경우**: 새로운 그룹을 추가하고 카운트를 1로 설정합니다.

### 삭제
- **동작**: 삭제할 튜플이 있을 때, 해당 튜플의 그룹을 찾아 카운트를 감소시킵니다.
  - **카운트 감소**: 만약 카운트가 0이 된다면, 해당 그룹을 `v`에서 삭제합니다.

### 예시
- 초기 상태: `v = { (1, 2), (2, 3) }` (그룹 1의 카운트 2, 그룹 2의 카운트 3)
- 삽입: 튜플 `(1)`이 추가되면, `v`는 `{ (1, 3), (2, 3) }`로 변경됩니다.
- 삭제: 튜플 `(2)`가 삭제되면, `v`는 `{ (1, 3), (2, 2) }`로 변경됩니다.

## 2. Sum

### 삽입
- **동작**: 새로운 튜플이 삽입되면, 해당 그룹의 값을 합산합니다.
  - **존재하는 경우**: 그룹의 합계에 새로운 튜플의 값을 추가합니다.
  - **존재하지 않는 경우**: 새로운 그룹을 추가하고 합계를 해당 튜플의 값으로 설정합니다.

### 삭제
- **동작**: 삭제할 튜플이 있을 때, 해당 튜플의 그룹에서 값을 빼줍니다.
  - **합계 감소**: 만약 특정 그룹의 합계가 0이 되면, 해당 그룹을 `v`에서 삭제합니다. 하지만 합계가 0일 때 단순히 삭제할 수 없는 이유는 다른 튜플이 여전히 존재할 수 있기 때문입니다.

### 예시
- 초기 상태: `v = { (1, 50), (2, 60) }` (그룹 1의 합계 50, 그룹 2의 합계 60)
- 삽입: 튜플 `(1, 20)`이 추가되면, `v`는 `{ (1, 70), (2, 60) }`로 변경됩니다.
- 삭제: 튜플 `(1, 50)`가 삭제되면, `v`는 `{ (1, 20), (2, 60) }`로 변경됩니다.

## 3. Average (avg)

### 처리 방법
- **합계와 카운트 별도 유지**: 평균을 계산하기 위해서는 합계와 카운트를 별도로 유지합니다.
- **삭제 시**: 특정 그룹의 튜플이 삭제되면, 해당 그룹의 합계에서 삭제된 값만큼 빼고, 카운트도 감소시킵니다.

### 예시
- 초기 상태: 그룹 1의 합계 50, 카운트 2 (평균 25)
- 삭제: 튜플 `(1, 20)`가 삭제되면, 그룹 1의 합계는 30, 카운트는 1이 되어 평균은 30이 됩니다.

## 4. Min and Max

### 삽입
- **동작**: 새로운 튜플이 삽입될 때, 해당 그룹의 최소값과 최대값을 업데이트합니다.
  - **최소값/최대값 변경**: 새로운 값이 기존의 최소값보다 작거나 최대값보다 클 경우, 해당 값을 업데이트합니다.

### 삭제
- **동작**: 만약 삭제할 튜플이 최소 최대이면 해당 그룹의 다른 튜플들을 확인하여 새로운 최소값 또는 최대값을 찾아야 합니다.
- **비용 발생**: 이 과정은 다른 튜플을 스캔해야 하므로 비용이 더 발생합니다.

### 예시
- 초기 상태: `v = { (1, min=10, max=20), (2, min=30, max=40) }`
- 삽입: 튜플 `(1, 5)`가 추가되면, 그룹 1의 최소값이 5로 업데이트됩니다.
- 삭제: 튜플 `(1, 20)`가 삭제되면, 그룹 1의 최대값을 찾기 위해 다른 튜플들을 확인해야 하므로 비용이 발생합니다.
