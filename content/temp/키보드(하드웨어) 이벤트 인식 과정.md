---
title: 키보드(하드웨어) 이벤트 인식 과정
resource-path: temp/키보드(하드웨어) 이벤트 인식 과정.md
---
리눅스에서 키보드를 인식하고 입력을 처리하는 과정은 여러 단계로 나뉘며, 하드웨어와 소프트웨어 간의 상호작용을 포함합니다. 아래는 리눅스 시스템에서 키보드가 인식되는 과정을 단계별로 설명한 것입니다.

---

### 1. **하드웨드 초기화 및 드라이버 로드**
키보드는 USB 또는 PS/2 포트를 통해 연결됩니다. 리눅스 커널은 부팅 과정에서 하드웨어 장치를 스캔하며, 연결된 키보드를 감지합니다.

- **USB 키보드**: USB 장치는 `usbhid` 드라이버에 의해 관리됩니다.
- **PS/2 키보드**: PS/2 장치는 `atkbd` 드라이버에 의해 관리됩니다.

커널은 적절한 드라이버를 자동으로 로드하여 키보드와 통신할 수 있도록 준비합니다.

---

### 2. **입력 이벤트 생성 (Input Subsystem)**
리눅스 커널에는 입력 장치를 추상화하는 **Input Subsystem**이라는 프레임워크가 있습니다. 이 시스템은 다양한 입력 장치(키보드, 마우스 등)를 일관된 방식으로 처리합니다.

- 키보드 드라이버는 사용자가 키를 누르거나 뗄 때마다 **스캔 코드**(Scan Code)라는 신호를 생성합니다.
- 이 스캔 코드는 커널 내부에서 처리되어 **키 코드**(Key Code)로 변환됩니다.
- 변환된 키 코드는 `/dev/input/eventX` 파일로 전달됩니다. 여기서 `X`는 특정 입력 장치에 할당된 번호입니다.

예를 들어, 키보드가 `/dev/input/event3`에 매핑되었다면, 이 파일을 읽으면 키보드 이벤트를 확인할 수 있습니다.

---

### 3. **사용자 공간에서의 처리**
커널이 생성한 이벤트는 사용자 공간(User Space)으로 전달되어 응용 프로그램에서 사용될 수 있습니다.

#### (1) **udev 및 장치 노드 생성**
- 리눅스의 `udev` 시스템은 새로운 입력 장치가 연결될 때 이를 감지하고 `/dev/input/` 디렉토리에 해당 장치 노드를 생성합니다.
- 예: `/dev/input/event3`, `/dev/input/by-id/usb-Keyboard_XXXX`

#### (2) **X Server 또는 Wayland**
GUI 환경에서는 **X Server** 또는 **Wayland**가 키보드 이벤트를 처리합니다.

- **X Server**: X 서버는 `/dev/input/eventX` 파일에서 이벤트를 읽고, 이를 GUI 애플리케이션에 전달합니다.
- **Wayland**: Wayland 컴포지터(compositor)가 직접 입력 이벤트를 처리하고 클라이언트에 전달합니다.

#### (3) **TTY(Teletype) 모드**
GUI가 없는 상태에서 텍스트 콘솔(TTY)을 사용하는 경우, 커널의 VT(Virtual Terminal) 서브시스템이 직접 키보드 이벤트를 처리합니다. 이 경우 키보드 입력은 현재 활성화된 TTY로 전달됩니다.

---

### 4. **응용 프로그램에서의 처리**
응용 프로그램은 키보드 이벤트를 다음과 같은 방법으로 처리할 수 있습니다.

- **직접 `/dev/input/eventX` 파일 읽기**: 낮은 수준에서 직접 이벤트를 읽습니다.
- **libinput 또는 evdev 라이브러리 사용**: 고수준 API를 통해 입력 이벤트를 처리합니다.
- **GUI 프레임워크 사용**: Qt, GTK 등의 GUI 프레임워크가 내부적으로 입력 이벤트를 처리합니다.

---

### 5. **키맵과 문자 매핑**
키보드의 물리적인 키는 스캔 코드와 키 코드로 식별되지만, 실제 문자(예: 'A', 'B')로 변환되려면 **키맵**(Keymap)이 필요합니다.

- **keymaps**: 키 코드를 문자나 명령으로 변환하는 규칙입니다.
- **loadkeys** 또는 **setxkbmap** 명령어를 사용하여 키맵을 설정할 수 있습니다.

예:
```bash
# 콘솔에서 키맵 설정
sudo loadkeys us

# X 서버에서 키맵 설정
setxkbmap us
```

---

### 요약
리눅스에서 키보드가 인식되고 처리되는 과정은 다음과 같습니다:

1. **하드웨어 감지**: 커널이 키보드를 감지하고 드라이버를 로드합니다.
2. **입력 이벤트 생성**: Input Subsystem이 키보드 이벤트를 처리하고 `/dev/input/eventX` 파일로 전달합니다.
3. **사용자 공간 처리**: udev, X Server, Wayland, 또는 TTY가 이벤트를 처리합니다.
4. **응용 프로그램 처리**: 응용 프로그램이 이벤트를 받아 사용자 입력을 처리합니다.
5. **키맵 적용**: 키 코드를 문자로 변환하여 출력합니다.

이 과정은 리눅스의 모듈화된 설계 덕분에 매우 유연하게 동작하며, 다양한 환경에서 동일한 하드웨어를 활용할 수 있도록 합니다.