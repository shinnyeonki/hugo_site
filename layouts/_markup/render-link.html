<!-- layouts/_default/_markup/render-link.html -->
{{- $url := .Destination -}}
{{- $text := .Text | safeHTML -}}
{{- $title := .Title -}}

{{- $parsedURL := urls.Parse $url -}}

{{- if $parsedURL.Scheme -}}
  {{- /* --------------------------------------------------------------------- */}}
  {{- /*  1. 외부 링크: URL Scheme(http, mailto 등)이 있는 경우            */}}
  {{- /* --------------------------------------------------------------------- */}}
  <a href="{{ $url | safeURL }}" target="_blank" rel="noopener noreferrer" {{ with $title }}title="{{ . }}"{{ end }}>{{ $text }}</a>

{{- else -}}
  {{- /* --------------------------------------------------------------------- */}}
  {{- /*  2. 내부 링크: Scheme이 없는 모든 경우                             */}}
  {{- /* --------------------------------------------------------------------- */}}
  {{- $finalURL := "" -}}
  {{- if strings.HasSuffix $parsedURL.Path ".md" -}}
    {{- /* .md로 끝나는 '페이지' 링크 
        (Hugo의 'relref' 함수는 앵커(#)를 포함한 경로를 받아
         정확한 경로로 변환해 주므로, URL을 분리할 필요가 없습니다.) */}}
    {{- $finalURL = relref .Page $url -}}
  {{- else -}}
    {{- /* 
      Case B, C: 앵커 전용 링크 또는 기타 '리소스' 링크 (PDF, ZIP 등)
      'relURL' 함수는 주어진 경로를 사이트 루트 기준의 상대 경로로 만들어 줍니다.
      앵커만 있는 링크('#heading')는 그대로 유지되므로 별도 처리가 필요 없습니다.
    */}}
    {{- $finalURL = $url | relURL -}}
  {{- end -}}

  <a href="{{ $finalURL | safeURL }}" {{ with $title }}title="{{ . }}"{{ end }}>{{ $text }}</a>

{{- end -}}