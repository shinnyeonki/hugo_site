{{- /* íŒŒë¼ë¯¸í„° ê°€ì ¸ì˜¤ê¸° (mode ê¸°ë³¸ê°’: 'regular') */ -}}
{{- $path := .Get "path" -}}
{{- $mode := .Get "mode" | default "regular" -}}
{{- /* ê° íŠ¸ë¦¬ ì¸ìŠ¤í„´ìŠ¤ì— ê³ ìœ  ID ë¶€ì—¬ */ -}}
{{- $treeID := printf "file-tree-%d" now.UnixNano -}}

<div id="{{ $treeID }}" class="file-tree p-4 mb-5 border border-gray-200 rounded-lg bg-gray-50 text-sm">

  {{- if $path -}}
    {{- /* --- ê²½ë¡œê°€ ì§€ì •ëœ ê²½ìš° --- */ -}}
    {{- with .Site.GetPage $path -}}
      <h4 class="text-base font-semibold text-gray-700 mb-2">'{{ $path }}' í•˜ìœ„ êµ¬ì¡° (Mode: {{ $mode }})</h4>
      <ul>
        <li>
          <details open> {{/* ì‹œì‘ì ì€ í•­ìƒ ì—´ë ¤ìˆë„ë¡ 'open' ì†ì„± ì¶”ê°€ */}}
            <summary class="flex items-center gap-x-2 cursor-pointer select-none">
              <span class="folder-icon text-lg">ğŸ“‚</span>
              <a href="{{ .RelPermalink }}" class="text-blue-600 hover:underline hover:text-blue-800">{{ .Title }}</a>
            </summary>
            {{- partial "file-tree.html" (dict "currentNode" . "mode" $mode) -}}
          </details>
        </li>
      </ul>
    {{- else -}}
      <p class="text-red-600">ì˜¤ë¥˜: ê²½ë¡œ '{{ $path }}'ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
    {{- end -}}

  {{- else -}}
    {{- /* --- ê²½ë¡œê°€ ì§€ì •ë˜ì§€ ì•Šì€ ê²½ìš° (ì „ì²´ êµ¬ì¡°) --- */ -}}
    <h4 class="text-base font-semibold text-gray-700 mb-2">ì‚¬ì´íŠ¸ ì „ì²´ êµ¬ì¡° (Mode: {{ $mode }})</h4>

    {{- if eq $mode "all" -}}
      {{- /* 'all' ëª¨ë“œì—ì„œëŠ” í™ˆí˜ì´ì§€ê°€ ëª¨ë“  ê²ƒì˜ ì‹œì‘ì  */ -}}
      {{- partial "file-tree.html" (dict "currentNode" .Site.Home "mode" $mode) -}}
    {{- else -}}
      {{- /* 'regular' ëª¨ë“œ: ìµœìƒìœ„ í´ë”ì™€ íŒŒì¼ì„ ê°ê° ì²˜ë¦¬ */ -}}
      <ul class="list-none p-0">
        {{- /* ìµœìƒìœ„ í´ë”(ì„¹ì…˜) ë¨¼ì € ìˆœíšŒ */ -}}
        {{- range .Site.Sections.ByTitle -}}
          <li class="mt-1">
            <details>
              <summary class="flex items-center gap-x-2 cursor-pointer select-none">
                <span class="folder-icon text-lg">ğŸ“</span>
                <a href="{{ .RelPermalink }}" class="text-blue-600 hover:underline hover:text-blue-800">{{ .Title }}</a>
              </summary>
              {{- partial "file-tree.html" (dict "currentNode" . "mode" $mode) -}}
            </details>
          </li>
        {{- end -}}

        {{- /* ìµœìƒìœ„ íŒŒì¼(í˜ì´ì§€) ìˆœíšŒ */ -}}
        {{- range where .Site.RegularPages "Section" "" | sort ".Title" -}}
          <li class="mt-1 flex items-center gap-x-2">
            <span class="text-lg">ğŸ“„</span>
            <a href="{{ .RelPermalink }}" class="text-gray-800 hover:underline">{{ .Title }}</a>
          </li>
        {{- end -}}
      </ul>
    {{- end -}}
  {{- end -}}
</div>

{{- /* ìŠ¤í¬ë¦½íŠ¸ëŠ” í˜ì´ì§€ë‹¹ í•œ ë²ˆë§Œ í¬í•¨ë˜ë„ë¡ ì²˜ë¦¬ */ -}}
{{- if not ($.Page.Scratch.Get "fileTreeScriptLoaded") -}}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const fileTrees = document.querySelectorAll('.file-tree');
    fileTrees.forEach(tree => {
      const detailsElements = tree.querySelectorAll('details');
      detailsElements.forEach(details => {
        const summary = details.querySelector('summary');
        const icon = summary.querySelector('.folder-icon');
        
        // ì´ˆê¸° ìƒíƒœê°€ ì—´ë ¤ìˆìœ¼ë©´ ì•„ì´ì½˜ ë³€ê²½
        if (details.hasAttribute('open')) {
            icon.textContent = 'ğŸ“‚';
        }

        details.addEventListener('toggle', () => {
          if (details.open) {
            icon.textContent = 'ğŸ“‚';
          } else {
            icon.textContent = 'ğŸ“';
          }
        });
      });
    });
  });
</script>
{{- $.Page.Scratch.Set "fileTreeScriptLoaded" true -}}
{{- end -}}