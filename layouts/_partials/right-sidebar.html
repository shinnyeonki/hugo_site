{{ if eq .Kind "page" }}
<div class="w-80 flex flex-col">
    <!-- 탭 네비게이션 -->
    <div role="tablist" aria-label="사이드바 컨텐츠" class="flex-shrink-0">
        <nav class="flex -mb-px" aria-label="Tabs">
            <button id="tab-toc" role="tab" aria-selected="true" aria-controls="panel-toc"
                class="right-tab-btn flex-1 py-3 px-1 text-center border-b-2 font-medium text-sm border-neutral-800 dark:border-neutral-100 text-neutral-800 dark:text-neutral-100 latin-font font-bold">
                Toc
            </button>
            <button id="tab-metadata" role="tab" aria-selected="false" aria-controls="panel-metadata" tabindex="-1"
                class="right-tab-btn flex-1 py-3 px-1 text-center border-b-2 font-medium text-sm border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300 dark:text-neutral-400 dark:hover:text-neutral-200 dark:hover:border-neutral-400 latin-font font-bold">
                Metadata
            </button>
            <button id="tab-links" role="tab" aria-selected="false" aria-controls="panel-links" tabindex="-1"
                class="right-tab-btn flex-1 py-3 px-1 text-center border-b-2 font-medium text-sm border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300 dark:text-neutral-400 dark:hover:text-neutral-200 dark:hover:border-neutral-400 latin-font font-bold">
                Links
            </button>
        </nav>
    </div>

    <!-- 탭 컨텐츠 -->
    <div class="flex-grow overflow-hidden mt-2 md:border-l md:border-neutral-200 dark:md:border-neutral-800 min-h-0">
        <div id="right-sidebar-track" class="flex h-full transition-transform duration-300 ease-in-out">
            <!-- TOC 패널 -->
            <div id="panel-toc" role="tabpanel" aria-labelledby="tab-toc" tabindex="0"
                class="right-tab-content w-full flex-shrink-0 h-full overflow-y-auto overflow-x-hidden px-2 py-4 text-sm">
                {{ with .TableOfContents }}
                    {{ . }}
                {{ else }}
                    <div class="text-gray-500 dark:text-gray-400 text-center py-8">
                        <p>목차가 없습니다</p>
                        <p class="text-xs mt-2">제목(heading)이 있는 경우 여기에 표시됩니다</p>
                    </div>
                {{ end }}
            </div>

            <!-- Metadata 패널 -->
            <div id="panel-metadata" role="tabpanel" aria-labelledby="tab-metadata" tabindex="0"
                class="right-tab-content w-full flex-shrink-0 h-full overflow-y-auto p-4 text-sm">
                <div class="space-y-4">
                    {{ range $key, $value := .Params }}
                        <div class="metadata-item">
                            <div class="text-xs font-medium text-gray-500 dark:text-gray-400 mb-1 capitalize">{{ $key }}</div>
                            {{ if eq $key "tags" }}
                                <div class="flex flex-wrap gap-2">
                                    {{ range $value }}
                                        <a href="/tags/{{ . | urlize }}" 
                                           class="px-2 py-1 text-xs bg-primary-blue-light/10 text-primary-blue-light dark:bg-primary-blue-light/20 rounded hover:bg-primary-blue-light/20 dark:hover:bg-primary-blue-light/30 transition-colors"
                                           onclick="event.stopPropagation()">
                                            {{ . }}
                                        </a>
                                    {{ end }}
                                </div>
                            {{ else if eq $key "iscjklanguage" }}
                            {{ else if eq $key "draft" }}    
                            {{ else }}
                                <div class="text-sm text-gray-700 dark:text-gray-300">
                                    {{ if reflect.IsSlice $value }}
                                        {{ delimit $value ", " }}
                                    {{ else }}
                                        {{ $value }}
                                    {{ end }}
                                </div>
                            {{ end }}
                        </div>
                    {{ end }}
                </div>
            </div>

            <!-- Links 패널 -->
            <div id="panel-links" role="tabpanel" aria-labelledby="tab-links" tabindex="0"
                class="right-tab-content w-full flex-shrink-0 h-full overflow-y-auto p-4 text-sm text-slate-600 dark:text-neutral-300">
                참조된 링크, 참조하는 링크 (구현 예정)
            </div>
        </div>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // -----------------------------
        // ----- 우측 사이드바 토글 로직 -----
        // -----------------------------
        const rightSidebar = document.getElementById('right-sidebar-container');
        const rightSidebarToggle = document.getElementById('rightSidebarToggle');

        const isTabletOrLarger = () => window.innerWidth >= 768;

        rightSidebarToggle.addEventListener('click', (e) => {
            e.stopPropagation();
            if (isTabletOrLarger()) {
                // 데스크톱: 너비를 조절하여 push 효과를 줍니다.
                rightSidebar.classList.toggle('md:w-80'); // 너비를 0에서 80로 또는 그 반대로 변경
            } else {
                // 모바일: translate 속성을 변경하여 오버레이 효과를 줍니다.
                rightSidebar.classList.toggle('translate-x-full');
            }
        });

        // --------------------------------
        // --- 우측 사이트바 내부 탭 전환 로직 ---
        // --------------------------------
        const tabs = document.querySelectorAll('.right-tab-btn');
        const track = document.getElementById('right-sidebar-track');
        const panels = document.querySelectorAll('.right-tab-content');
        const tabNameToIndex = {
            'tab-toc': 0,
            'tab-metadata': 1,
            'tab-links': 2,
        };

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // 모든 탭의 활성 스타일 제거
                tabs.forEach(t => {
                    t.setAttribute('aria-selected', 'false');
                    t.classList.remove('border-neutral-800', 'dark:border-neutral-100', 'text-neutral-800', 'dark:text-neutral-100');
                    t.classList.add('border-transparent', 'text-slate-500', 'hover:text-slate-700', 'hover:border-slate-300', 'dark:text-neutral-400', 'dark:hover:text-neutral-200', 'dark:hover:border-neutral-400');
                });

                // 클릭된 탭에 활성 스타일 적용
                tab.setAttribute('aria-selected', 'true');
                tab.classList.add('border-neutral-800', 'dark:border-neutral-100', 'text-neutral-800', 'dark:text-neutral-100');
                tab.classList.remove('border-transparent', 'text-slate-500', 'hover:text-slate-700', 'hover:border-slate-300', 'dark:text-neutral-400', 'dark:hover:text-neutral-200', 'dark:hover:border-neutral-400');

                // 콘텐츠 트랙을 해당 위치로 슬라이드
                const tabIndex = tabNameToIndex[tab.id];
                if (tabIndex !== undefined) {
                    track.style.transform = `translateX(-${tabIndex * 100}%)`;
                }
            });
        });
    });
</script>
{{ end }}