{{- if .Params.date }}
{{- $commentId := .Date.Format "2006-01-02T15:04:05-07:00" }}
<section class="comments" id="comments-section">
  <hr style="border: none; border-top: 1px solid #e1e4e8; margin: 2rem 0 1rem 0;">
  <script>console.log("comment ID : {{ $commentId }}");</script>
  <script async
    src="https://utteranc.es/client.js"
    repo="shinnyeonki/blog-comment"
    issue-term="{{ $commentId }}"
    label="Comment"
    theme="github-light"
    crossorigin="anonymous"
    async>
  </script>
</section>

<script>
  // Utterances 테마를 사이트 다크모드에 동기화
  function updateUtterancesTheme() {
    const isDark = document.documentElement.classList.contains('dark');
    const theme = isDark ? 'github-dark' : 'github-light';
    
    const utterancesFrame = document.querySelector('.utterances-frame');
    if (utterancesFrame) {
      const message = {
        type: 'set-theme',
        theme: theme
      };
      utterancesFrame.contentWindow.postMessage(message, 'https://utteranc.es');
    }
  }

  // MutationObserver로 html 태그의 class 변화 감지
  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
        updateUtterancesTheme();
      }
    });
  });

  // html 태그 관찰 시작
  observer.observe(document.documentElement, {
    attributes: true,
    attributeFilter: ['class']
  });

  // 초기 테마 설정 (Utterances iframe 로드 후)
  window.addEventListener('message', (event) => {
    if (event.origin === 'https://utteranc.es') {
      updateUtterancesTheme();
    }
  });
</script>
{{- end }}