
{{- /*  ì´ Partialì€ ë‹¤ìŒ ì¸ìˆ˜ë¥¼ ë°›ìŠµë‹ˆë‹¤:
  - currentNode: í˜„ì¬ íƒìƒ‰ ì¤‘ì¸ í˜ì´ì§€ ê°ì²´ (ì„¹ì…˜ ë˜ëŠ” í™ˆí˜ì´ì§€)
  - mode: "regular" ë˜ëŠ” "all"
*/ -}}
{{- $currentNode := .currentNode -}}
{{- $mode := .mode -}}

{{- /* 1. í•˜ìœ„ ìš”ì†Œë“¤ì„ ê°€ì ¸ì˜µë‹ˆë‹¤. í´ë”(Sections)ì™€ íŒŒì¼(Pages)ë¡œ ë¶„ë¦¬í•˜ì—¬ ì •ë ¬í•©ë‹ˆë‹¤. */ -}}
{{- $sections := $currentNode.Sections.ByTitle -}}
{{- $pages := "" -}}
{{- if eq $mode "all" -}}
  {{- /* 'all' ëª¨ë“œ: í˜„ì¬ ë…¸ë“œ ì•„ë˜ì˜ ëª¨ë“  í˜ì´ì§€ ì¤‘ ì„¹ì…˜ì´ ì•„ë‹Œ ê²ƒë“¤ì„ ê°€ì ¸ì™€ì„œ ì œëª©ìˆœìœ¼ë¡œ ì •ë ¬ */ -}}
  {{- $filteredPages := where $currentNode.Pages "IsSection" false -}}
  {{- $pages = $filteredPages.ByTitle -}}
{{- else -}}
  {{- /* 'regular' ëª¨ë“œ: í˜„ì¬ ë…¸ë“œ ì•„ë˜ì˜ ì¼ë°˜ ì½˜í…ì¸  í˜ì´ì§€ë§Œ */ -}}
  {{- $pages = $currentNode.RegularPages.ByTitle -}}
{{- end -}}

{{- if or $sections $pages -}}
<ul class="pl-4">
  {{- /* 2. í´ë”(ì„¹ì…˜)ë¥¼ ë¨¼ì € ìˆœíšŒí•˜ë©° ì¶œë ¥í•©ë‹ˆë‹¤. */ -}}
  {{- range $sections -}}
    <li class="mt-1">
      {{- /* details/summary íƒœê·¸ë¡œ ì ‘ê¸°/í´ê¸° ê¸°ëŠ¥ êµ¬í˜„ */ -}}
      <details>
        <summary class="flex items-center gap-x-2 cursor-pointer select-none">
          <span class="folder-icon text-lg">ğŸ“</span>
          <a href="{{ .RelPermalink }}" class="text-blue-600 hover:underline hover:text-blue-800">{{ .Title }}</a>
        </summary>
        {{- /* ìì‹ ì„ ë‹¤ì‹œ í˜¸ì¶œí•˜ì—¬ ì¬ê·€ì ìœ¼ë¡œ í•˜ìœ„ êµ¬ì¡°ë¥¼ ê·¸ë¦½ë‹ˆë‹¤. */ -}}
        {{- partial "file-tree.html" (dict "currentNode" . "mode" $mode) -}}
      </details>
    </li>
  {{- end -}}

  {{- /* 3. íŒŒì¼(í˜ì´ì§€)ì„ ìˆœíšŒí•˜ë©° ì¶œë ¥í•©ë‹ˆë‹¤. */ -}}
  {{- range $pages -}}
    <li class="mt-1 flex items-center gap-x-2">
      <span class="text-lg">
        {{- /* í˜ì´ì§€ ì¢…ë¥˜(Kind)ì— ë”°ë¼ ì•„ì´ì½˜ í‘œì‹œ */ -}}
        {{- if .IsSection }}<span title="Section">ğŸ“</span>
        {{- else if eq .Kind "page" }}<span title="Page">ğŸ“„</span>
        {{- else if eq .Kind "taxonomy" }}<span title="Taxonomy List">ğŸ·ï¸</span>
        {{- else if eq .Kind "term" }}<span title="Taxonomy Term">ğŸ”–</span>
        {{- else if eq .Kind "home" }}<span title="Home">ğŸ </span>
        {{- else }}<span title="Other">ğŸ”—</span>
        {{- end -}}
      </span>
      <a href="{{ .RelPermalink }}" class="text-gray-800 hover:underline">{{ .Title }}</a>
      {{- if eq $.mode "all" -}}
        <small class="text-gray-500"> (Kind: {{ .Kind }})</small>
      {{- end -}}
    </li>
  {{- end -}}
</ul>
{{- end -}}