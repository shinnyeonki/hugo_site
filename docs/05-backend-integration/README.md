# 백엔드 연동 (Backend Integration)

이 섹션은 **향후 추가될 백엔드 시스템**의 설계와 구현 계획을 다룹니다.

## 📍 현재 상태

- ⚠️ **아직 구현되지 않음**
- 📋 설계 단계 (완료)
- 🔜 구현 예정

## 🎯 백엔드가 필요한 이유

Hugo는 정적 사이트 생성기(SSG)로, 빌드 타임에 모든 HTML을 생성합니다. 이는 다음과 같은 장점이 있습니다:

- ✅ 완벽한 SEO
- ✅ 빠른 초기 로딩
- ✅ 보안 (서버 사이드 취약점 없음)
- ✅ 저렴한 호스팅 (GitHub Pages 무료)

하지만 **사용자 생성 콘텐츠(User-Generated Content)**는 정적 사이트의 한계입니다:

| 기능 | 정적 사이트 가능 여부 | 이유 |
|------|---------------------|------|
| 블로그 글 표시 | ✅ 가능 | 빌드 타임에 HTML 생성 |
| 댓글 표시 | ❌ 불가능 | 실시간으로 변경되는 데이터 |
| 댓글 작성 | ❌ 불가능 | 데이터 저장 필요 |

> **결론**: 댓글 시스템과 같은 동적 기능을 위해 **최소한의 백엔드**가 필요합니다.

## 🏗️ 아키텍처 개요

```
┌─────────────────────────────────────────────────────────────┐
│                   정적 사이트 (Hugo)                         │
│                  GitHub Pages 호스팅                         │
│                                                             │
│  ✅ 모든 콘텐츠 (블로그 글)                                   │
│  ✅ SEO 최적화                                               │
│  ✅ 초기 HTML 생성                                           │
└─────────────────────┬───────────────────────────────────────┘
                      │
                      │ HTTP API 호출
                      │ (댓글 CRUD)
                      ↓
┌─────────────────────────────────────────────────────────────┐
│              백엔드 마이크로서비스 (Python)                   │
│               클라우드 호스팅 (Fly.io 등)                     │
│                                                             │
│  ✅ 댓글 관리 (CRUD)                                         │
│  ✅ 사용자 인증 (OAuth)                                      │
│  ✅ 데이터 영속성 (SQLite)                                   │
└─────────────────────────────────────────────────────────────┘
```

## 🔑 핵심 원칙

### 1. **데이터 소유권 (Data Ownership)**

**문제**: 외부 댓글 서비스 (Disqus, utterances 등)의 한계
- 내 데이터가 외부 플랫폼에 종속
- 서비스 종료 시 데이터 손실 위험
- 커스터마이징 제한
- 광고 삽입 (Disqus)

**해결**: 자체 백엔드 구축
- ✅ 완전한 데이터 소유권
- ✅ 원하는 대로 커스터마이징
- ✅ 플랫폼 독립성
- ✅ 광고 없음

### 2. **최소한의 백엔드 (Minimal Backend)**

백엔드가 하는 일:
- ✅ 댓글 CRUD (Create, Read, Update, Delete)
- ✅ 사용자 인증 (Google OAuth)
- ✅ 권한 관리 (Admin vs User)

백엔드가 하지 **않는** 일:
- ❌ HTML 렌더링 (Hugo가 함)
- ❌ 콘텐츠 관리 (Obsidian + Git)
- ❌ SEO (Hugo가 함)
- ❌ 이미지 호스팅 (정적 파일)

### 3. **경량성 (Lightweight)**

**기술 스택 선택 이유**:

| 기술 | 선택 이유 |
|------|----------|
| **Python** | 간단한 문법, 빠른 개발 |
| **FastAPI** | 고성능, 자동 API 문서 |
| **SQLite** | 서버리스, 간단한 배포 |
| **OAuth 2.0** | 표준 인증 프로토콜 |

**리소스 요구사항**:
- 메모리: ~100MB
- 스토리지: ~10MB (SQLite DB)
- 트래픽: 낮음 (댓글만)

## 📚 문서 구조

### [comment-system.md](comment-system.md) - 댓글 시스템 설계

**주요 내용**:
- 데이터베이스 스키마 (users, comments)
- API 엔드포인트 명세
- 인증/인가 흐름 (OAuth 2.0 + JWT)
- Post ID 전략 (`created` 타임스탬프)
- 권한 관리 (Admin vs User)
- 프론트엔드-백엔드 통합

**핵심 기능**:
1. **Google OAuth 로그인**: 간편한 소셜 로그인
2. **JWT 기반 인증**: Stateless 인증
3. **역할 기반 권한**: Admin/User 구분
4. **시간제한 수정/삭제**: 일반 사용자는 10분 이내만 가능
5. **대댓글 지원**: `parent_id`로 스레드 구조

### [api-architecture.md](api-architecture.md) - API 아키텍처

**주요 내용**:
- RESTful API 설계
- CORS 정책 상세
- 보안 고려사항
- 배포 전략
- 확장 계획

## 🚀 구현 단계

### Phase 1: 기본 댓글 시스템 (현재 설계 완료)
- [x] 데이터베이스 스키마 설계
- [x] API 엔드포인트 정의
- [x] 인증/인가 흐름 설계
- [ ] FastAPI 백엔드 구현
- [ ] 프론트엔드 JavaScript 구현
- [ ] 배포 (Fly.io 등)

### Phase 2: 기능 확장
- [ ] 대댓글 (Threaded Comments)
- [ ] 댓글 좋아요/싫어요
- [ ] 댓글 신고 기능
- [ ] 관리자 대시보드

### Phase 3: 추가 동적 기능
- [ ] 조회수 추적
- [ ] 글 추천 (좋아요)
- [ ] 북마크 기능
- [ ] 실시간 알림

## 🔐 보안 고려사항

### 1. **인증 (Authentication)**
- Google OAuth 2.0 사용
- JWT를 통한 세션 관리
- HttpOnly 쿠키 또는 localStorage

### 2. **인가 (Authorization)**
- 역할 기반 권한 (RBAC)
- Admin: 모든 댓글 수정/삭제 가능
- User: 본인 댓글만, 10분 이내 수정/삭제

### 3. **CORS (Cross-Origin Resource Sharing)**
- 명시적 출처 허용 (`allow_origins`)
- 와일드카드(`*`) 금지
- 자격 증명 허용 (`allow_credentials=True`)

### 4. **입력 검증**
- FastAPI Pydantic 모델 사용
- XSS 방지 (HTML 이스케이핑)
- SQL Injection 방지 (ORM 사용)

## 💡 왜 외부 서비스를 쓰지 않는가?

### Disqus의 문제점
- ❌ 광고 삽입
- ❌ 사용자 추적
- ❌ 데이터 소유권 부족
- ❌ 커스터마이징 제한
- ❌ 느린 로딩 속도

### utterances의 문제점
- ✅ 오픈소스, 무료
- ✅ GitHub Issues 기반
- ❌ GitHub 계정 필수 (진입장벽)
- ❌ GitHub API Rate Limit
- ❌ 커스터마이징 제한

### 자체 백엔드의 장점
- ✅ 완전한 통제권
- ✅ 데이터 소유권
- ✅ 원하는 기능 추가 가능
- ✅ UI/UX 완전 커스터마이징
- ✅ 성능 최적화 가능

## 📊 비용 분석

### 호스팅 비용 (예상)

| 서비스 | 무료 티어 | 유료 (필요 시) |
|--------|-----------|---------------|
| **Fly.io** | 3 Shared CPU, 256MB RAM | $5/월 |
| **Railway** | $5 크레딧/월 | $5/월~ |
| **Vercel Serverless** | 100GB-Hrs/월 | 사용량 기반 |

**예상 비용**: $0~5/월 (소규모 블로그 기준)

### 개발 시간 (예상)

| 단계 | 시간 |
|------|------|
| 백엔드 구현 | 8-16시간 |
| 프론트엔드 구현 | 4-8시간 |
| 테스트 및 배포 | 4-8시간 |
| **총** | **16-32시간** |

## 🔮 미래 확장 가능성

### 단기 (1-3개월)
- ✅ 기본 댓글 CRUD
- ✅ Google OAuth 로그인
- ✅ Admin 권한 관리

### 중기 (3-6개월)
- 📋 대댓글 (Nested Comments)
- 📋 댓글 알림 (이메일)
- 📋 Markdown 지원

### 장기 (6개월+)
- 📋 다른 OAuth 제공자 (GitHub, Twitter)
- 📋 실시간 댓글 (WebSocket)
- 📋 AI 기반 스팸 필터링
- 📋 다국어 지원

## 🔗 관련 문서

- [DESIGN_PRINCIPLES.md](../DESIGN_PRINCIPLES.md) - 왜 백엔드가 필요한가?
- [WORKFLOW_OVERVIEW.md](../WORKFLOW_OVERVIEW.md) - 전체 워크플로우에서의 백엔드 역할
- [comment-system.md](comment-system.md) - 댓글 시스템 상세 설계
- [api-architecture.md](api-architecture.md) - API 아키텍처

---

**마지막 업데이트**: 2025년 10월 30일
